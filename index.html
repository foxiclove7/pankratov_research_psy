<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Психологическое исследование</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Все стили из предыдущего кода остаются */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root {
            --primary-blue: #1e3a8a; --secondary-blue: #3b82f6; --light-blue: #eff6ff;
            --dark-blue: #1e40af; --accent-blue: #60a5fa; --text-dark: #1f2937;
            --text-light: #6b7280; --white: #ffffff; --gray: #f3f4f6; --border: #d1d5db;
        }
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--text-dark); line-height: 1.6; min-height: 100vh;
            position: relative; overflow-x: hidden;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                            radial-gradient(circle at 80% 70%, rgba(30, 64, 175, 0.05) 0%, transparent 50%),
                            radial-gradient(circle at 40% 80%, rgba(96, 165, 250, 0.05) 0%, transparent 50%);
            z-index: -1;
        }
        .container {
             max-width: 800px;
             margin: 0 auto; 
             padding: 30px 20px; 
             position: relative; 
            }
        
        .page {
             background-color: rgba(255, 255, 255, 0.95); 
             border-radius: 20px; 
             box-shadow: 0 10px 30px rgba(30, 58, 138, 0.1); 
             padding: 40px; 
             margin-bottom: 30px; 
             border: 1px solid rgba(59, 130, 246, 0.2); 
             backdrop-filter: blur(10px); 
             animation: fadeIn 0.5s ease-out; 
            }
            
            @keyframes fadeIn {
                 from {
                     opacity: 0; 
                     transform: translateY(20px); 
                    } 
                    to {
                        opacity: 1; 
                        transform: translateY(0); 
                    } 
                }

                .hidden { 
                    display: none !important; 
                }

                h1, h2, h3 { 
                    color: var(--primary-blue); 
                    margin-bottom: 25px; 
                    text-align: center; 
                }

                h1 { 
                    font-size: 32px; 
                    border-bottom: 3px solid var(--secondary-blue); 
                    padding-bottom: 15px; 
                    margin-bottom: 30px; 
                }

                h2 {
                    font-size: 28px; 
                    color: var(--dark-blue); 
                    margin-top: 10px; 
                }

                .intro-text { 
                    background: linear-gradient(135deg, var(--light-blue) 0%, #dbeafe 100%); 
                    padding: 25px; 
                    border-radius: 15px; 
                    border-left: 5px solid var(--secondary-blue); 
                    margin-bottom: 30px; 
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); 
                }

                .question {
                    background: var(--white); 
                    margin: 25px 0; 
                    padding: 25px; 
                    border-radius: 15px; 
                    border: 2px solid var(--gray); 
                    transition: all 0.3s ease; 
                    position: relative; 
                    overflow: hidden; 
                }

                .question:hover {
                    border-color: var(--accent-blue); 
                    transform: translateY(-2px); 
                    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15); 
                }

                .question::before {
                     content: ''; 
                     position: absolute; 
                     top: 0; 
                     left: 0;
                     width: 5px; 
                     height: 100%; 
                     background: linear-gradient(to bottom, var(--secondary-blue), var(--accent-blue)); 
                    }

                     .question-number {
                        display: inline-block; 
                        background: linear-gradient(135deg, var(--secondary-blue), var(--dark-blue)); 
                        color: white; width: 36px; height: 36px; 
                        border-radius: 50%; 
                        text-align: center; 
                        line-height: 36px; 
                        margin-right: 15px; 
                        font-weight: bold; 
                        font-size: 18px; 
                        box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); 
                    }

                    .question-text {
                        font-weight: 600; 
                        margin-bottom: 20px; 
                        color: var(--text-dark); 
                        font-size: 18px; 
                        display: flex; 
                        align-items: center;
                        min-height: 36px; 
                    }

                    .options-container {
                        display: flex; 
                        flex-direction: column; 
                        gap: 15px; 
                        margin-left: 50px; 
                    }

                    .option { 
                        display: flex; 
                        align-items: center; 
                        padding: 15px 20px; 
                        border: 2px solid var(--border); 
                        border-radius: 12px; 
                        cursor: pointer; 
                        transition: all 0.3s ease; 
                        background: var(--white); 
                    }

                    .option:hover { 
                        background: var(--light-blue); 
                        border-color: var(--accent-blue); 
                        transform: translateX(5px); 
                    }

                    .option.selected {
                        background: linear-gradient(135deg, #dbeafe, #bfdbfe); 
                        border-color: var(--secondary-blue); 
                        font-weight: 600; 
                        color: var(--dark-blue); 
                        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2); 
                    }

                    .option input {
                        margin-right: 15px; 
                        cursor: pointer; 
                        transform: scale(1.2); 
                    }

                    .text-input {
                        width: 100%; 
                        padding: 15px 20px; 
                        border: 2px solid var(--border); 
                        border-radius: 12px; 
                        font-size: 16px; 
                        transition: all 0.3s; 
                        background: var(--white);
                    }
                    
                    .text-input:focus {
                        outline: none; 
                        border-color: var(--secondary-blue); 
                        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2); 
                        background: var(--light-blue); 
                    }
                    
                    .btn {
                        background: linear-gradient(135deg, var(--secondary-blue), var(--dark-blue)); 
                        color: white; 
                        border: none; 
                        padding: 18px 40px; 
                        border-radius: 12px; 
                        font-size: 18px; 
                        font-weight: 600; 
                        cursor: pointer; 
                        transition: all 0.3s; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        gap: 12px; 
                        margin: 40px auto 0;
                        box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3); 
                        position: relative; 
                        overflow: hidden; 
                    }

                    .btn:hover {
                        transform: translateY(-3px); 
                        box-shadow: 0 10px 25px rgba(30, 64, 175, 0.4); 
                    }

                    .consent-container { 
                        background: linear-gradient(135deg, var(--light-blue) 0%, #dbeafe 100%); 
                        padding: 30px; 
                        border-radius: 15px; 
                        margin: 30px 0; 
                        border: 2px solid var(--accent-blue); 
                    }

                    .error-message { 
                        color: #dc2626; 
                        font-size: 15px; 
                        margin-top: 10px; 
                        padding: 10px 15px; 
                        background: rgba(220, 38, 38, 0.1); 
                        border-radius: 8px; 
                        border-left: 4px solid #dc2626; 
                        display: none; 
                    }

                    .test-instructions { 
                        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); 
                        padding: 25px; 
                        border-radius: 15px; 
                        margin-bottom: 30px; 
                        border-left: 5px solid var(--accent-blue); 
                        font-style: italic; 
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); 
                    }

                    .thank-you { 
                        text-align: center; 
                        padding: 60px 40px; 
                        background: linear-gradient(135deg, var(--light-blue) 0%, #dbeafe 100%); 
                        border-radius: 20px; 
                        border: 2px solid var(--accent-blue); 
                    }

                    .perma-scale { 
                        display: flex; 
                        flex-direction: column; 
                        align-items: center; 
                        margin: 25px 0 0 50px;
                    }

                    .scale-labels { 
                        display: flex; 
                        justify-content: space-between; 
                        width: 100%; margin-bottom: 15px; 
                        font-size: 14px; 
                        color: var(--text-light); 
                        font-weight: 500; 
                    }

                    .scale-numbers { 
                        display: flex; 
                        justify-content: space-between; 
                        width: 100%; 
                        margin-top: 15px;
                    }

                    .scale-number { 
                        width: 40px; 
                        height: 40px; 
                        border-radius: 50%; 
                        background: var(--gray); 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        cursor: pointer; 
                        transition: all 0.3s; 
                        font-weight: bold; 
                        font-size: 16px; 
                        color: var(--text-dark);
                    }

                    .scale-number:hover, .scale-number.selected { 
                        background: linear-gradient(135deg, var(--secondary-blue), var(--dark-blue)); 
                        color: white; 
                        transform: scale(1.1); 
                        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); 
                    }

                    .progress-indicator {
                        display: flex; 
                        justify-content: space-between; 
                        margin-bottom: 40px; 
                        position: relative;
                    }

        .progress-indicator::before {
            content: ''; 
            position: absolute; 
            top: 50%; 
            left: 0; 
            right: 0; 
            height: 4px; 
            background: var(--border); 
            transform: translateY(-50%); 
            z-index: 0;
        }

        .progress-step {
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            background: var(--gray); 
            border: 3px solid var(--border); 
            position: relative; 
            z-index: 1; 
            transition: all 0.3s;
        }

        .progress-step.active {
            background: var(--secondary-blue); 
            border-color: var(--dark-blue); 
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        * Добавьте эти строки в самый конец файла */
#country-input,
#education-other-input {
    padding-left: 50px;
    box-sizing: border-box;
}

#country-input input,
#education-other-input input {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box;
}

        @media (max-width: 768px) {
           .container { padding: 15px; }
           .page { padding: 25px 20px; }
           .question-text { flex-direction: column; align-items: flex-start; }
           .options-container, .text-input, .perma-scale { margin-left: 0; margin-top: 15px; }
           .scale-number { width: 35px; height: 35px; }
          }

    </style>
</head>

<body>
    <div class="container">
        <!-- Прогресс-индикатор -->
        <div class="progress-indicator hidden" id="progress-indicator">
            <div class="progress-step" data-step="1"></div>
            <div class="progress-step" data-step="2"></div>
            <div class="progress-step" data-step="3"></div>
            <div class="progress-step" data-step="4"></div>
            <div class="progress-step" data-step="5"></div>
            <div class="progress-step" data-step="6"></div>
        </div>

        <!-- СТРАНИЦА 1: ПРИВЕТСТВИЕ -->
        <div class="page" id="page-1">
            <div class="logo"><i class="fas fa-brain"></i><h1>Психологическое исследование</h1></div>
            <div class="intro-text">
                <p><strong>Здравствуйте!</strong> Вы приглашены принять участие в психологическом исследовании, направленном на изучение индивидуальных особенностей и опыта взрослых людей.</p>
                <p><strong>Участие является добровольным и анонимным;</strong> все полученные данные будут использованы исключительно в обобщённом виде для научных целей.</p>
                <p>Заполнение анкеты займёт около <strong>20–25 минут</strong>. Вы можете прекратить участие на любом этапе без объяснения причин.</p>
            </div>
            <div class="consent-container">
                <div class="consent-checkbox"><input type="checkbox" id="consent-checkbox">
                    <div class="consent-text"><p><strong>Если вы согласны принять участие, пожалуйста, отметьте галочкой данное согласие:</strong></p>
                        <ul><li>Мне понятны цели исследования</li><li>Мое участие является добровольным</li><li>Я могу отказаться от участия в любой момент</li><li>Мои данные будут использованы анонимно и обобщенно</li></ul>
                    </div>
                </div>
                <div class="error-message" id="consent-error">Необходимо дать согласие на участие в исследовании</div>
            </div>
            <button class="btn" id="btn-next-1">Принять участие и начать <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- СТРАНИЦА 2: АНКЕТА -->
        <div class="page hidden" id="page-2">
            <h2>Анкета участника</h2>
            <div class="intro-text"><p><strong>Инструкция:</strong> Анкета является анонимной. Полученные данные будут использованы исключительно в обобщённом виде для научных целей. Пожалуйста, отвечайте искренне.</p></div>
            <form id="demographic-form">
                <div class="question"><div class="question-text"><span class="question-number">1</span><span class="required">Ваш возраст</span></div>
                    <div class="options-container"><label class="option"><input type="radio" name="age" value="18–24 года" required>18–24 года</label>
                        <label class="option"><input type="radio" name="age" value="25–34 года">25–34 года</label>
                        <label class="option"><input type="radio" name="age" value="35–44 года">35–44 года</label>
                        <label class="option"><input type="radio" name="age" value="45–54 года">45–54 года</label>
                        <label class="option"><input type="radio" name="age" value="55 лет и старше">55 лет и старше</label>
                    </div>
                </div>
                <div class="question"><div class="question-text"><span class="question-number">2</span><span class="required">Ваш пол</span></div>
                    <div class="options-container"><label class="option"><input type="radio" name="gender" value="Мужской" required>Мужской</label>
                        <label class="option"><input type="radio" name="gender" value="Женский">Женский</label>
                        <label class="option"><input type="radio" name="gender" value="Предпочитаю не указывать">Предпочитаю не указывать</label>
                    </div>
                </div>
                <div class="question">
                    <div class="question-text"><span class="question-number">3</span><span class="required">Страна проживания</span></div>
                    <div class="options-container">
                        <label class="option" onclick="toggleInput()">
                            <input type="radio" name="country" value="Российская Федерация" required>Российская Федерация</label>
                        <label class="option" onclick="toggleInput()">
                            <input type="radio" name="country" value="Другая страна">Другая страна (указать)</label>
                        <div id="country-input" style="margin-top: 15px; display: none;">
                            <input type="text" class="text-input" id="country-other-text" placeholder="Введите название страны">
                        </div>
                    </div>
                </div>
                <div class="question"><div class="question-text"><span class="question-number">4</span><span class="required">Тип населённого пункта проживания</span></div>
                    <div class="options-container"><label class="option"><input type="radio" name="location" value="Крупный город (более 1 млн жителей)" required>Крупный город (более 1 млн жителей)</label>
                        <label class="option"><input type="radio" name="location" value="Город (100 тыс. – 1 млн)">Город (100 тыс. – 1 млн)</label>
                        <label class="option"><input type="radio" name="location" value="Малый город / посёлок">Малый город / посёлок</label>
                        <label class="option"><input type="radio" name="location" value="Сельская местность">Сельская местность</label>
                    </div>
                </div>
                <div class="question"><div class="question-text"><span class="question-number">5</span><span class="required">Сфера вашей основной профессиональной деятельности</span></div>
                    <input type="text" class="text-input" name="profession" placeholder="Например: образование, бизнес, IT, медицина, культура, управление и т.д." required>
                </div>
                <div class="question"><div class="question-text"><span class="question-number">6</span><span class="required">Ваш общий стаж профессиональной деятельности</span></div>
                    <div class="options-container"><label class="option"><input type="radio" name="experience" value="Менее 1 года" required>Менее 1 года</label>
                        <label class="option"><input type="radio" name="experience" value="1–3 года">1–3 года</label>
                        <label class="option"><input type="radio" name="experience" value="4–7 лет">4–7 лет</label>
                        <label class="option"><input type="radio" name="experience" value="8–15 лет">8–15 лет</label>
                        <label class="option"><input type="radio" name="experience" value="Более 15 лет">Более 15 лет</label>
                    </div>
                </div>
                <div class="question"><div class="question-text"><span class="question-number">7</span><span class="required">Занимаете ли вы в настоящее время управленческую позицию?</span></div>
                    <div class="options-container"><label class="option"><input type="radio" name="manager" value="Да" required>Да</label>
                        <label class="option"><input type="radio" name="manager" value="Нет">Нет</label>
                    </div>
                </div>
                <div class="question"><div class="question-text"><span class="question-number">8</span><span class="required">Имеете ли вы коучинговое образование?</span></div>
    <div class="options-container">
        <label class="option" onclick="toggleCoachingFormat()">
            <input type="radio" name="coaching_edu" value="Да, профессиональное коучинговое образование" required>
            Да, профессиональное коучинговое образование
        </label>
        <label class="option" onclick="toggleCoachingFormat()">
            <input type="radio" name="coaching_edu" value="Прохожу обучение в настоящее время">
            Прохожу обучение в настоящее время
        </label>
        <label class="option" onclick="toggleCoachingFormat()">
            <input type="radio" name="coaching_edu" value="Проходил(а) краткосрочные курсы / тренинги по коучингу">
            Проходил(а) краткосрочные курсы / тренинги по коучингу
        </label>
        <label class="option" onclick="toggleCoachingFormat()">
            <input type="radio" name="coaching_edu" id="no-coaching" value="Нет, коучингового образования нет">
            Нет, коучингового образования нет
        </label>
    </div>
</div>

<div class="question" id="coaching-format-question" style="display: none;">
    <div class="question-text"><span class="question-number">9</span><span>Если у вас есть коучинговое образование, укажите его формат</span></div>
    <div class="options-container">
        <label class="option" onclick="toggleCoachingOther()">
            <input type="checkbox" name="coaching_format" value="Международная сертификация (ICF, EMCC и др.)">
            Международная сертификация (ICF, EMCC и др.)
        </label>
        <label class="option" onclick="toggleCoachingOther()">
            <input type="checkbox" name="coaching_format" value="Российская программа профессиональной переподготовки">
            Российская программа профессиональной переподготовки
        </label>
        <label class="option" onclick="toggleCoachingOther()">
            <input type="checkbox" name="coaching_format" value="Краткосрочные курсы / тренинги">
            Краткосрочные курсы / тренинги
        </label>
        <label class="option" onclick="toggleCoachingOther()">
            <input type="checkbox" name="coaching_format" id="coaching-other-checkbox" value="Другое">
            Другое (указать)
        </label>
        <div id="coaching-other-input" style="margin-top: 15px; display: none;">
            <input type="text" class="text-input" id="coaching-other-text" placeholder="Укажите другой формат">
        </div>
    </div>
</div>
                <div class="question"><div class="question-text"><span class="question-number">10</span><span class="required">Используете ли вы коучинговые инструменты в профессиональной деятельности?</span></div>
                    <div class="options-container"><label class="option"><input type="radio" name="coaching_use" value="Никогда" required>Никогда</label>
                        <label class="option"><input type="radio" name="coaching_use" value="Редко">Редко</label>
                        <label class="option"><input type="radio" name="coaching_use" value="Иногда">Иногда</label>
                        <label class="option"><input type="radio" name="coaching_use" value="Часто">Часто</label>
                        <label class="option"><input type="radio" name="coaching_use" value="Постоянно">Постоянно</label>
                    </div>
                </div>
            </form>
            <button class="btn" id="btn-next-2">Далее <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- СТРАНИЦА 3-6: ТЕСТЫ (будут заполнены через JS) -->
        <div class="page hidden" id="page-3"><h2>Опросник №1</h2><div class="test-instructions"><p><strong>Инструкция:</strong> Ответьте, пожалуйста, на несколько вопросов о себе. Выбирайте тот ответ, который наилучшим образом отражает Ваше мнение. Здесь нет правильных или неправильных ответов, так как важно только Ваше мнение. Подолгу не задумывайтесь над ответами. Работайте последовательно, не пропуская вопросов.</p></div><form id="hardiness-form"></form><button class="btn" id="btn-next-3">Далее<i class="fas fa-arrow-right"></i></button></div>
        <div class="page hidden" id="page-4"><h2>Опросник №2</h2><div class="test-instructions"><p><strong>Инструкция:</strong> Просим Вас ответить на вопросы, представленные ниже. Выбирайте, пожалуйста, соответствующий вариант ответа, наиболее полно описывающий Вашу жизнь.</p></div><form id="perma-form"></form><button class="btn" id="btn-next-4">Далее<i class="fas fa-arrow-right"></i></button></div>
        <div class="page hidden" id="page-5"><h2>Опросник №3</h2><div class="test-instructions"><p><strong>Инструкция:</strong> Пожалуйста, оцените, насколько каждое из следующих утверждений соответствует вам.</p></div><form id="gse-form"></form><button class="btn" id="btn-next-5">Далее<i class="fas fa-arrow-right"></i></button></div>
        <div class="page hidden" id="page-6"><h2>Опросник №4</h2><div class="test-instructions"><p><strong>Инструкция:</strong> Вам предлагается заполнить опросник, состоящий из 46 утверждений. Читайте внимательно каждое утверждение и отмечайте тот ответ, который лучше всего отражает Ваше мнение.</p></div><form id="emin-form"></form><button class="btn" id="btn-submit-all">Завершить исследование<i class="fas fa-check"></i></button></div>

        <!-- СТРАНИЦА 7: ЗАВЕРШЕНИЕ -->
        <div class="page hidden" id="page-7"><div class="thank-you"><i class="fas fa-heart"></i><h2>Благодарим вас за участие в исследовании!</h2><p>Ваши ответы имеют большое значение для научного анализа и будут использованы только в обобщённом виде.</p><p style="margin-top: 30px; font-size: 16px; color: var(--text-light);"><i class="fas fa-check-circle" style="color: var(--secondary-blue);"></i> Данные успешно сохранены</p></div></div>
    </div>

    <!-- Скрытая форма для Google Forms -->
    <iframe name="hidden-iframe" id="hidden-iframe" style="display: none;"></iframe>
    <form id="google-form" action="https://docs.google.com/forms/d/e/1FAIpQLSevaO9z06KMc1oUrvlFZ7U_BaDw_SMVRmvc9k7n-H9nDvLFaw/formResponse" method="POST" target="hidden-iframe">
        <!-- Поля будут добавлены динамически -->
    </form>

    <script>
        // === КОНФИГУРАЦИЯ ПО КЛЮЧАМ ===
        const config = {
            // Ключи преобразования
            conversion: {
                // Жизнестойкость: прямые вопросы
                hardiness_direct: {"Нет": 0, "Скорее нет": 1, "Скорее да": 2, "Да": 3},
                // Жизнестойкость: обратные вопросы (2,3,10,11,14,28,32,37,38,40,42 и др.)
                hardiness_reverse: {"Нет": 3, "Скорее нет": 2, "Скорее да": 1, "Да": 0},
                
                // GSE: прямые вопросы
                gse: {"Абсолютно неверно": 1, "Едва ли это верно": 2, "Скорее всего верно": 3, "Совершенно верно": 4},
                
                // ЭМИН: прямые вопросы
                emin_direct: {"Совсем не согласен": 1, "Скорее не согласен": 2, "Скорее согласен": 3, "Полностью согласен": 4},
                // ЭМИН: обратные вопросы (вопросы с минусом в ключе)
                emin_reverse: {"Совсем не согласен": 4, "Скорее не согласен": 3, "Скорее согласен": 2, "Полностью согласен": 1},
                
                // PERMA: значения как есть (0-10)
                perma: value => parseInt(value)
            },
            
            // Обратные вопросы (индексы с 0)
            reverseQuestions: {
                hardiness: [1,2,9,10,13,27,31,36,37,39,41], // Вопросы 2,3,10,11,14,28,32,37,38,40,42
                emin: [1,4,5,7,9,10,11,16,17,18,21,22,29,30,31,33,34,35,37,38,39,40,41,42,43,44,45] // Вопросы с минусом
            },
            
            // Вопросы тестов
            questions: {
                hardiness: [
                    "Я часто не уверен в собственных решениях",
                    "Иногда мне кажется, что никому нет до меня дела",
                    "Часто, даже хорошо выспавшись, я с трудом заставляю себя встать с постели",
                    "Я постоянно занят, и мне это нравится",
                    "Часто я предпочитаю «плыть по течению»",
                    "Я меняю свои планы в зависимости от обстоятельств",
                    "Меня раздражают события, из-за которых я вынужден менять свой распорядок дня",
                    "Непредвиденные трудности порой сильно утомляют меня",
                    "Я всегда контролирую ситуацию настолько, насколько это необходимо",
                    "Порой я так устаю, что уже ничто не может заинтересовать меня",
                    "Порой все, что я делаю, кажется мне бесполезным",
                    "Я стараюсь быть в курсе всего происходящего вокруг меня",
                    "Лучше синица в руках, чем журавль в небе",
                    "Вечером я часто чувствую себя совершенно разбитым",
                    "Я предпочитаю ставить перед собой труднодостижимые цели и добиваться их",
                    "Иногда меня пугают мысли о будущем",
                    "Я всегда уверен, что смогу воплотить в жизнь то, что задумал",
                    "Мне кажется, что я не живу полной жизнью, а только играю роль",
                    "Мне кажется, если бы в прошлом у меня было меньше разочарований и невзгод, мне было бы легче жить в настоящем",
                    "Возникающие проблемы часто кажутся мне неразрешимыми",
                    "Испытав поражение, я буду пытаться взять реванш",
                    "Я люблю знакомиться с новыми людьми",
                    "Когда кто-нибудь жалуется, что жизнь скучна, это значит, что он просто не умеет видеть интересное",
                    "Мне всегда есть чем заняться",
                    "Я всегда могу повлиять на результат того, что происходит вокруг",
                    "Я часто сожалею о том, что уже сделано",
                    "Если проблема требует больших усилий, я предпочту отложить её до лучших времен",
                    "Мне трудно сближаться с другими людьми",
                    "Как правило, окружающие слушают меня внимательно",
                    "Если бы я мог, я многое изменил бы в прошлом",
                    "Я довольно часто откладываю на завтра то, что трудно осуществимо, или то, в чем я не уверен",
                    "Мне кажется, жизнь проходит мимо меня",
                    "Мои мечты редко сбываются",
                    "Неожиданности дарят мне интерес к жизни",
                    "Порой мне кажется, что все мои усилия тщетны",
                    "Порой я мечтаю о спокойной размеренной жизни",
                    "Мне не хватает упорства закончить начатое",
                    "Бывает, жизнь кажется мне скучной и бесцветной",
                    "У меня нет возможности влиять на неожиданные проблемы",
                    "Окружающие меня недооценивают",
                    "Как правило, я работаю с удовольствием",
                    "Иногда я чувствую себя лишним даже в кругу друзей",
                    "Бывает, на меня наваливается столько проблем, что просто руки опускаются",
                    "Друзья уважают меня за упорство и непреклонность",
                    "Я охотно берусь воплощать новые идеи"
                ],
                perma: [
                    "Как часто Вы чувствуете, что приближаетесь к своей цели?",
                    "Как часто Вы бываете полностью поглощены тем, что делаете?",
                    "Как часто Вы испытываете радость?",
                    "Как часто Вы испытываете беспокойство?",
                    "Как часто Вы достигаете важных целей, которые ставите перед собой?",
                    "В целом, как Вы оцениваете Ваше здоровье?",
                    "В какой степени Вы целеустремлены и живете полной/осмысленной жизнью?",
                    "В какой степени Вы удовлетворены тем, какую помощь и поддержку от других Вы получаете, когда в ней нуждаетесь?",
                    "В какой степени Вы считаете, что то, что Вы делаете в своей жизни, полезно и ценно?",
                    "Как Вам кажется, насколько Вы увлечены или заинтересованы в чем-то?",
                    "Насколько одиноким Вы себя чувствуете в этой жизни?",
                    "Насколько Вы удовлетворены своим нынешним физическим здоровьем?",
                    "Как часто Вы испытываете положительные (позитивные) эмоции?",
                    "Как часто Вы злитесь?",
                    "Как часто Вы выполняете возложенные на Вас обязанности?",
                    "Как часто Вам бывает грустно?",
                    "Как часто Вы бываете чем-то так сильно увлечены, что теряете счет времени?",
                    "По сравнению с другими людьми того же возраста и пола как Вы оцениваете Ваше здоровье?",
                    "В какой степени Вы чувствуете себя любимым?",
                    "Насколько, как Вам кажется, Ваша жизнь имеет цель, и Вы движетесь к этой цели?",
                    "Насколько Вы довольны взаимоотношениями в личной жизни?",
                    "В целом, насколько Вы довольны своей жизнью?",
                    "В целом, как Вам кажется, насколько Вы счастливы?"
                ],
                gse: [
                    "Если я как следует постараюсь, то я всегда найду решение даже сложным проблемам.",
                    "Если мне что-либо мешает, то я всё же нахожу пути достижения своей цели.",
                    "Мне довольно просто удается достичь своих целей.",
                    "В неожиданных ситуациях я всегда знаю, как я должен(-а) себя вести.",
                    "При непредвиденно возникающих трудностях я верю, что смогу с ними справиться.",
                    "Если я приложу достаточно усилий, то смогу справиться с большинством проблем.",
                    "Я готов(-а) к любым трудностям, поскольку полагаюсь на собственные способности.",
                    "Если передо мной встает какая-либо проблема, то я обычно нахожу несколько вариантов её решения.",
                    "Я могу что-либо придумать даже в безвыходных на первый взгляд ситуациях.",
                    "Я обычно способен(-а) держать ситуацию под контролем."
                ],
                emin: [
                    "Я замечаю, когда близкий человек переживает, даже если он (она) пытается это скрыть",
                    "Если человек на меня обижается, я не знаю, как восстановить с ним хорошие отношения",
                    "Мне легко догадаться о чувствах человека по выражению его лица",
                    "Я хорошо знаю, чем заняться, чтобы улучшить себе настроение",
                    "У меня обычно не получается повлиять на эмоциональное состояние своего собеседника",
                    "Когда я раздражаюсь, то не могу сдержаться, и говорю всё, что думаю",
                    "Я хорошо понимаю, почему мне нравятся или не нравятся те или иные люди",
                    "Я не сразу замечаю, когда начинаю злиться",
                    "Я умею улучшить настроение окружающих",
                    "Если я увлекаюсь разговором, то говорю слишком громко и активно жестикулирую",
                    "Я понимаю душевное состояние некоторых людей без слов",
                    "В экстремальной ситуации я не могу усилием вола взять себя в руки",
                    "Я легко понимаю мимику и жесты других людей",
                    "Когда я злюсь, я знаю, почему",
                    "Я знаю, как ободрить человека, находящегося в тяжелой ситуации",
                    "Окружающие считают меня слишком эмоциональным человеком",
                    "Я способен успокоить близких, когда они находятся в напряжённом состоянии",
                    "Мне бывает трудно описать, что я чувствую по отношению к другим",
                    "Если я смущаюсь при общении с незнакомыми людьми, то могу это скрыть",
                    "Глядя на человека, я легко могу понять его эмоциональное состояние",
                    "Я контролирую выражение чувств на своем лице",
                    "Бывает, что я не понимаю, почему испытываю то или иное чувство",
                    "В критических ситуациях я умею контролировать выражение своих эмоций",
                    "Если надо, я могу разозлить человека",
                    "Когда я испытываю положительные эмоции, я знаю, как поддержать это состояние",
                    "Как правило, я понимаю, какую эмоцию испытываю",
                    "Если собеседник пытается скрыть свои эмоций, я сразу чувствует это",
                    "Я знаю как успокоиться, если я разозлился",
                    "Можно определить, что чувствует человек, просто прислушиваясь к звучанию его голоса",
                    "Я не умею управлять эмоциями других людей",
                    "Мне трудно отличить чувство вины от чувства стыда",
                    "Я умею точно угадывать, что чувствуют мои знакомые",
                    "Мне трудно справляться с плохим настроением",
                    "Если внимательно следить за выражением лица человека, то можно понять, какие эмоции он скрывает",
                    "Я не нахожу слов, чтобы описать свои чувства друзьям",
                    "Мне удаётся поддержать людей, которые делятся со мной своими переживаниями",
                    "Я умею контролировать свои эмоции",
                    "Если мой собеседник начинает раздражаться, я подчас замечаю это слишком поздно",
                    "По интонации моего голоса легко догадаться о том, что я чувствую",
                    "Если близкий человек плачет, я теряюсь",
                    "Мне бывает весело или грустно без всякой причины",
                    "Мне трудно предвидеть смену настроения у окружающих меня людей",
                    "Я не умею преодолевать страх",
                    "Бывает, что я хочу поддержать человека, а он этого не чувствует, не понимает",
                    "У меня бывают чувства, которые я не могу точно определить",
                    "Я не понимаю, почему некоторые люди на меня обижаются"
                ]
            }
        };

        // === ID полей Google Forms (НУЖНО ЗАПОЛНИТЬ!) ===
        const fieldIds = {
            // АНКЕТА (текст)
            age: "entry.2062968811",
            gender: "entry.1838256035",
            country: "entry.1069794579",
            country_other: "entry.1422721313",
            location: "entry.232272482", 
            profession: "entry.577720819", 
            experience: "entry.2111220557",
            manager: "entry.809169509",
            coaching_edu: "entry.1225698729", 
            coaching_format: "entry.1827088797",
            coaching_other: "entry.1267161364",
            coaching_use: "entry.1065420322", 
            
            // === ЖИЗНЕСТОЙКОСТЬ (результаты) ===
             hardiness_engagement: "entry.1440705895", 
             hardiness_control: "entry.156983109", 
             hardiness_risk: "entry.59879277", 
             hardiness_total: "entry.1957353618",
            
            // === PERMA (результаты) ===
            perma_positive: "entry.123139332",
            perma_engagement: "entry.1286866332", 
            perma_relationships: "entry.1087490402",
            perma_meaning: "entry.797431395",
            perma_accomplishment: "entry.1664888450",
            perma_happiness: "entry.1881363753",
            perma_negative: "entry.506773851",
            perma_health: "entry.702593872",
            perma_loneliness: "entry.1805132823",
            perma_total: "entry.27140809",

            // === GSE (результаты) ===
            gse_total: "entry.824093292",
            gse_result: "entry.2004913685", 

            // === ЭМИН (результаты) ===
            emin_MP: "entry.1813433004",
            emin_MU: "entry.1287234286", 
            emin_VP: "entry.109897569",
            emin_VU: "entry.1956376896",
            emin_VE: "entry.312565547",
            emin_MEI: "entry.945932969",
            emin_VEI: "entry.1005179086",
            emin_PE: "entry.1618945901",
            emin_UE: "entry.1913163216",
            emin_OEI: "entry.407648291",
            
            // ЖИЗНЕСТОЙКОСТЬ (числа 0-3)
            h1: "entry.1750753256", 
            h2: "entry.1679179462", 
            h3: "entry.1617052396", 
            h4: "entry.1263946020", 
            h5: "entry.836392443", 
            h6: "entry.936070539", 
            h7: "entry.1823636750", 
            h8: "entry.1415503441", 
            h9: "entry.120908733", 
            h10: "entry.1576740828", 
            h11: "entry.462424541", 
            h12: "entry.1485208372", 
            h13: "entry.1179907395", 
            h14: "entry.674199064", 
            h15: "entry.1859587526", 
            h16: "entry.853466114", 
            h17: "entry.1347194956", 
            h18: "entry.670634469", 
            h19: "entry.278760171", 
            h20: "entry.752275978", 
            h21: "entry.1487929441", 
            h22: "entry.1380724539", 
            h23: "entry.1255430698", 
            h24: "entry.557862474", 
            h25: "entry.1227513792", 
            h26: "entry.1622057381", 
            h27: "entry.800380550", 
            h28: "entry.2094593489", 
            h29: "entry.1584204705", 
            h30: "entry.543507463", 
            h31: "entry.1892380724", 
            h32: "entry.1203459240", 
            h33: "entry.764395559", 
            h34: "entry.1706108792", 
            h35: "entry.759904124", 
            h36: "entry.1638986977", 
            h37: "entry.1754233891", 
            h38: "entry.922773670", 
            h39: "entry.28064954", 
            h40: "entry.1921373443", 
            h41: "entry.1879361158", 
            h42: "entry.900493493", 
            h43: "entry.17690021", 
            h44: "entry.210153218", 
            h45: "entry.1314489091",
            
            // PERMA (числа 0-10)
            p1: "entry.820243098", 
            p2: "entry.461285287", 
            p3: "entry.1752249121", 
            p4: "entry.887264297", 
            p5: "entry.1860974054", 
            p6: "entry.485407814", 
            p7: "entry.647998971", 
            p8: "entry.509603031", 
            p9: "entry.1541850951", 
            p10: "entry.1563838060", 
            p11: "entry.98211568", 
            p12: "entry.695738218", 
            p13: "entry.1508388682", 
            p14: "entry.907084478", 
            p15: "entry.656599173", 
            p16: "entry.1801640091", 
            p17: "entry.1632141632", 
            p18: "entry.1217542794", 
            p19: "entry.1659030389", 
            p20: "entry.1845819040", 
            p21: "entry.470009969", 
            p22: "entry.1041579553", 
            p23: "entry.2013184101",
            
            // GSE (числа 1-4)
            g1: "entry.1986881198", 
            g2: "entry.1660047972", 
            g3: "entry.695444461", 
            g4: "entry.449766470", 
            g5: "entry.193665566", 
            g6: "entry.1982333447", 
            g7: "entry.216094061", 
            g8: "entry.852746899", 
            g9: "entry.1669318262", 
            g10: "entry.892421237",
            
            // ЭМИН (числа 1-4)
            e1: "entry.715592580", 
            e2: "entry.342928821", 
            e3: "entry.145857806", 
            e4: "entry.677511297", 
            e5: "entry.1173891606", 
            e6: "entry.213229875", 
            e7: "entry.320131408", 
            e8: "entry.1264318678", 
            e9: "entry.627262610", 
            e10: "entry.664790618", 
            e11: "entry.1113883032", 
            e12: "entry.441686489", 
            e13: "entry.1395391395", 
            e14: "entry.1208552282", 
            e15: "entry.1502793136", 
            e16: "entry.58611045", 
            e17: "entry.1190626568", 
            e18: "entry.1948969576", 
            e19: "entry.45738444", 
            e20: "entry.619993726", 
            e21: "entry.1886040173", 
            e22: "entry.166643339", 
            e23: "entry.184479961", 
            e24: "entry.1166733933", 
            e25: "entry.1056505211", 
            e26: "entry.1949670662", 
            e27: "entry.708832655", 
            e28: "entry.993119501", 
            e29: "entry.392057712", 
            e30: "entry.68330674", 
            e31: "entry.614928617", 
            e32: "entry.1818744100",
            e33: "entry.1642471060", 
            e34: "entry.314708604", 
            e35: "entry.453558105", 
            e36: "entry.2142852854", 
            e37: "entry.2014191801", 
            e38: "entry.1620795857", 
            e39: "entry.1989124036", 
            e40: "entry.215887564", 
            e41: "entry.289898071", 
            e42: "entry.800415360", 
            e43: "entry.1766257603", 
            e44: "entry.117794083", 
            e45: "entry.146722044", 
            e46: "entry.914633404",
        };

        // === СОСТОЯНИЕ ===
        const state = {
            currentPage: 1,
            answers: {
                demographic: {},
                hardiness: new Array(45).fill(null),
                perma: new Array(23).fill(null),
                gse: new Array(10).fill(null),
                emin: new Array(46).fill(null)
            }
        };

        // === ИНИЦИАЛИЗАЦИЯ ===
        document.addEventListener('DOMContentLoaded', function() {
            initHardinessTest();
            initPermaTest();
            initGseTest();
            initEminTest();
            setupEventListeners();
            initVisualEffects();
            showPage(1);
        });

        // === ИНИЦИАЛИЗАЦИЯ ТЕСТОВ ===
        function initHardinessTest() {
            const form = document.getElementById('hardiness-form');
            form.innerHTML = '';
            config.questions.hardiness.forEach((question, index) => {
                const isReverse = config.reverseQuestions.hardiness.includes(index);
                const questionDiv = createQuestion(index + 1, question, 'hardiness', isReverse);
                form.appendChild(questionDiv);
            });
        }

        function initPermaTest() {
            const form = document.getElementById('perma-form');
            form.innerHTML = '';
            config.questions.perma.forEach((question, index) => {
                const questionDiv = createPermaQuestion(index + 1, question);
                form.appendChild(questionDiv);
            });
        }

        function initGseTest() {
            const form = document.getElementById('gse-form');
            form.innerHTML = '';
            config.questions.gse.forEach((question, index) => {
                const questionDiv = createQuestion(index + 1, question, 'gse', false);
                form.appendChild(questionDiv);
            });
        }

        function initEminTest() {
            const form = document.getElementById('emin-form');
            form.innerHTML = '';
            config.questions.emin.forEach((question, index) => {
                const isReverse = config.reverseQuestions.emin.includes(index);
                const questionDiv = createQuestion(index + 1, question, 'emin', isReverse);
                form.appendChild(questionDiv);
            });
        }

        // === СОЗДАНИЕ ВОПРОСОВ ===
        function createQuestion(number, text, type, isReverse = false) {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.dataset.type = type;
            questionDiv.dataset.index = number - 1;
            questionDiv.dataset.reverse = isReverse;
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            
            const numberSpan = document.createElement('span');
            numberSpan.className = 'question-number';
            numberSpan.textContent = number;
            
            const textSpan = document.createElement('span');
            textSpan.className = 'required';
            textSpan.textContent = text;
            
            questionText.appendChild(numberSpan);
            questionText.appendChild(textSpan);
            
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            
            let options, values;
            switch(type) {
                case 'hardiness':
                    options = ["Нет", "Скорее нет", "Скорее да", "Да"];
                    values = isReverse ? [3,2,1,0] : [0,1,2,3];
                    break;
                case 'gse':
                    options = ["Абсолютно неверно", "Едва ли это верно", "Скорее всего верно", "Совершенно верно"];
                    values = [1,2,3,4];
                    break;
                case 'emin':
                    options = ["Совсем не согласен", "Скорее не согласен", "Скорее согласен", "Полностью согласен"];
                    values = isReverse ? [4,3,2,1] : [1,2,3,4];
                    break;
            }
            
            options.forEach((option, idx) => {
                const optionLabel = document.createElement('label');
                optionLabel.className = 'option';
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `${type}-${number-1}`;
                input.value = values[idx];
                input.required = true;
                
                const optionText = document.createTextNode(option);
                
                optionLabel.appendChild(input);
                optionLabel.appendChild(optionText);
                
                input.addEventListener('change', function() {
                    state.answers[type][number-1] = parseInt(this.value);
                });
                
                optionsContainer.appendChild(optionLabel);
            });
            
            questionDiv.appendChild(questionText);
            questionDiv.appendChild(optionsContainer);
            return questionDiv;
        }

        function createPermaQuestion(number, text) {
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';
    questionDiv.dataset.type = 'perma';
    questionDiv.dataset.index = number - 1;
    
    const questionText = document.createElement('div');
    questionText.className = 'question-text';
    
    const numberSpan = document.createElement('span');
    numberSpan.className = 'question-number';
    numberSpan.textContent = number;
    
    const textSpan = document.createElement('span');
    textSpan.className = 'required';
    textSpan.textContent = text;
    
    questionText.appendChild(numberSpan);
    questionText.appendChild(textSpan);
    
    // Создаем красивую линейку PERMA
    const permaScale = document.createElement('div');
    permaScale.className = 'perma-scale';
    
    // Метки шкалы (левая и правая)
    const scaleLabels = document.createElement('div');
    scaleLabels.className = 'scale-labels';
    
    // Определяем метки в зависимости от номера вопроса
    let leftLabel = "0";
    let rightLabel = "10";
    
    // Специальные метки для некоторых вопросов PERMA
    const permaLabels = {
        1: ["0 — никогда", "10 — всегда"],
        2: ["0 — никогда", "10 — всегда"],
        3: ["0 — никогда", "10 — всегда"],
        4: ["0 — никогда", "10 — всегда"],
        5: ["0 — никогда", "10 — всегда"],
        6: ["0 — ужасно", "10 — великолепно"],
        7: ["0 — совсем нет", "10 — максимальное значение"],
        8: ["0 — совсем нет", "10 — максимальное значение"],
        9: ["0 — совсем нет", "10 — максимальное значение"],
        10: ["0 — совсем нет", "10 — максимальное значение"],
        11: ["0 — совсем нет", "10 — максимальное значение"],
        12: ["0 — совсем нет", "10 — максимальное значение"],
        13: ["0 — никогда", "10 — всегда"],
        14: ["0 — никогда", "10 — всегда"],
        15: ["0 — никогда", "10 — всегда"],
        16: ["0 — никогда", "10 — всегда"],
        17: ["0 — никогда", "10 — всегда"],
        18: ["0 — ужасно", "10 — великолепно"],
        19: ["0 — минимальное значение", "10 — максимальное значение"],
        20: ["0 — совсем нет", "10 — максимальное значение"],
        21: ["0 — совсем нет", "10 — максимальное значение"],
        22: ["0 — совсем нет", "10 — максимальное значение"],
        23: ["0 — совсем нет", "10 — максимальное значение"]
    };
    
    if (permaLabels[number]) {
        leftLabel = permaLabels[number][0];
        rightLabel = permaLabels[number][1];
    }
    
    const leftLabelSpan = document.createElement('span');
    leftLabelSpan.textContent = leftLabel;
    
    const rightLabelSpan = document.createElement('span');
    rightLabelSpan.textContent = rightLabel;
    
    scaleLabels.appendChild(leftLabelSpan);
    scaleLabels.appendChild(rightLabelSpan);
    
        // Цифры от 0 до 10
    const scaleNumbers = document.createElement('div');
    scaleNumbers.className = 'scale-numbers';
    
    for (let i = 0; i <= 10; i++) {
        const scaleNumber = document.createElement('div');
        scaleNumber.className = 'scale-number';
        scaleNumber.textContent = i;
        scaleNumber.dataset.value = i;
        scaleNumbers.appendChild(scaleNumber);
        
        // Скрытый input
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = `perma-${number-1}`;
        input.value = i;
        input.id = `perma-${number-1}-${i}`;
        input.style.display = 'none';
        input.required = true;
        
        // Обработчик выбора
        const selectHandler = function() {
            state.answers.perma[number-1] = i;
            
            // Сбрасываем все выделения в этом вопросе
            questionDiv.querySelectorAll('.scale-number').forEach(num => {
                num.classList.remove('selected');
            });
            
            // Выделяем выбранное
            scaleNumber.classList.add('selected');
            input.checked = true;
        };
        
        scaleNumber.addEventListener('click', selectHandler);
        input.addEventListener('change', selectHandler);
        
        // Добавляем input в scaleNumber
        scaleNumber.appendChild(input);
    }
    
    permaScale.appendChild(scaleLabels);
    permaScale.appendChild(scaleNumbers);
    
    questionDiv.appendChild(questionText);
    questionDiv.appendChild(permaScale);
    
    return questionDiv;
};

        // === ОБРАБОТЧИКИ ===
        function setupEventListeners() {
            document.getElementById('btn-next-1').addEventListener('click', () => {
                if (!document.getElementById('consent-checkbox').checked) {
                    document.getElementById('consent-error').style.display = 'block';
                    return;
                }
                document.getElementById('consent-error').style.display = 'none';
                showPage(2);
            });
            
            document.getElementById('btn-next-2').addEventListener('click', () => {
                if (validateDemographicForm()) {
                    collectDemographicAnswers();
                    showPage(3);
                }
            });
            
            document.getElementById('btn-next-3').addEventListener('click', () => {
                if (validateForm('hardiness-form')) showPage(4);
            });
            
            document.getElementById('btn-next-4').addEventListener('click', () => {
                if (validateForm('perma-form')) showPage(5);
            });
            
            document.getElementById('btn-next-5').addEventListener('click', () => {
                if (validateForm('gse-form')) showPage(6);
            });
            
            document.getElementById('btn-submit-all').addEventListener('click', () => {
                if (validateForm('emin-form')) {
                    submitToGoogleForms();
                    showPage(7);
                }
            });
        }

        function initVisualEffects() {
            document.addEventListener('change', function(e) {
                if (e.target.type === 'radio') {
                    const parent = e.target.closest('.option');
                    if (parent) {
                        const name = e.target.name;
                        document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
                            radio.closest('.option')?.classList.remove('selected');
                        });
                        parent.classList.add('selected');
                    }
                }
                if (e.target.type === 'checkbox') {
                    const parent = e.target.closest('.option');
                    if (parent) parent.classList.toggle('selected', e.target.checked);
                }
            });
        }

        // === ВАЛИДАЦИЯ ===
        function validateDemographicForm() {
            let isValid = true;
            let firstInvalid = null;
            const radioGroups = ['age', 'gender', 'country', 'location', 'experience', 'manager', 'coaching_edu', 'coaching_use'];

            radioGroups.forEach(group => {
                const radios = document.querySelectorAll(`input[name="${group}"]`);
                if (radios.length > 0) {
                    let isChecked = false;
                    radios.forEach(radio => {
                        if (radio.checked) {
                            isChecked = true;
                        }
                    });
                    
                    const question = radios[0].closest('.question');

                    if (isChecked) {
                        question?.classList.remove('has-error');
                    }
                    else {
                        isValid = false;

                        if (question) {
                            question.classList.add('has-error');

                            if (!firstInvalid) {
                                firstInvalid = question;
                            }
                        }
                    }
                }
            });

            let textInput = document.querySelector('input[name="profession"]');
            let textQuestion = textInput.closest('.question');

            if (textInput.value.trim()) {
                textQuestion?.classList.remove('has-error');
            }
            else {
                isValid = false;

                if (textQuestion) {
                    textQuestion.classList.add('has-error');

                    if (!firstInvalid) {
                        firstInvalid = textQuestion;
                    }
                }
            }

            if (document.querySelector('input[name="country"][value="Другая страна"]').checked) {
                textInput = document.getElementById('country-other-text');
                textQuestion = textInput.closest('.question');

                if (textInput.value.trim()) {
                    textQuestion?.classList.remove('has-error');
                }
                else {
                    isValid = false;

                    if (textQuestion) {
                        textQuestion.classList.add('has-error');

                        if (!firstInvalid) {
                            firstInvalid = textQuestion;
                        }
                    }
                }
            }

            if (!document.getElementById('no-coaching').checked) {
                let isChecked = false;

                const checkBoxes = document.querySelectorAll('input[name="coaching_format"]');

                checkBoxes.forEach(cb => {
                    if (cb.checked) {
                        isChecked = true;
                    }
                });
                    
                const coachingFormatQuestion = checkBoxes[0].closest('.question');

                if (isChecked) {
                    if (document.getElementById('coaching-other-checkbox').checked) {
                        textInput = document.getElementById('coaching-other-text');

                        if (textInput.value.trim()) {
                            coachingFormatQuestion?.classList.remove('has-error');
                        }
                        else {
                            isValid = false;

                            if (coachingFormatQuestion) {
                                coachingFormatQuestion.classList.add('has-error');

                                if (!firstInvalid) {
                                    firstInvalid = coachingFormatQuestion;
                                }
                            }
                        }
                    }
                    else {
                        coachingFormatQuestion?.classList.remove('has-error');
                    }
                }
                else {
                    isValid = false;

                    if (coachingFormatQuestion) {
                        coachingFormatQuestion.classList.add('has-error');

                        if (!firstInvalid) {
                            firstInvalid = coachingFormatQuestion;
                        }
                    }
                }
            }

            if (!isValid) {
                alert('Пожалуйста, заполните все обязательные поля');

                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Анимация внимания
                    firstInvalid.style.animation = 'none';
                    setTimeout(() => {
                        firstInvalid.style.animation = 'shake 0.5s';
                    }, 10);
                }
            }

            return isValid;
        }

        function validateForm(formId) {
            const form = document.getElementById(formId);
            let isValid = true;
            let firstInvalid = null;

            const inputs = form.querySelectorAll('input[required]');
            const groupedInputs = Object.groupBy(inputs, input => {
                return input.name;
            });

            Object.keys(groupedInputs).forEach(name => {
                let isChecked = false;
                const inputGroup = groupedInputs[name];

                inputGroup.forEach(input => {
                    if (input.checked) {
                        isChecked = true;
                    }
                });
        
                const question = inputGroup[0].closest('.question');
                if (isChecked) {
                    question?.classList.remove('has-error');
                }
                else {
                    isValid = false;
                    if (question) {
                        question.classList.add('has-error');

                        if (!firstInvalid) {
                            firstInvalid = question;
                        }
                    }
                }
            });

            if (!isValid) {
                alert('Пожалуйста, ответьте на все вопросы');

                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Анимация внимания
                    firstInvalid.style.animation = 'none';
                    setTimeout(() => {
                        firstInvalid.style.animation = 'shake 0.5s';
                    }, 10);
                }
            }

            return isValid;
        }

        // === СБОР ДАННЫХ ===
        function collectDemographicAnswers() {
            const formData = new FormData(document.getElementById('demographic-form'));
            state.answers.demographic.age = formData.get('age');
            state.answers.demographic.gender = formData.get('gender');
            state.answers.demographic.country = formData.get('country');
            if (state.answers.demographic.country === 'Другая страна') {
                state.answers.demographic.country_other = document.getElementById('country-other-text').value;
            }
            state.answers.demographic.location = formData.get('location');
            state.answers.demographic.profession = formData.get('profession');
            state.answers.demographic.experience = formData.get('experience');
            state.answers.demographic.manager = formData.get('manager');
            state.answers.demographic.coaching_edu = formData.get('coaching_edu');
            state.answers.demographic.coaching_use = formData.get('coaching_use');
            const coachingCheckboxes = document.querySelectorAll('input[name="coaching_format"]:checked');
            state.answers.demographic.coaching_format = Array.from(coachingCheckboxes).map(cb => cb.value);
            if (document.getElementById('coaching-other-checkbox')?.checked) {
                state.answers.demographic.coaching_other = document.getElementById('coaching-other-text').value;
            }
        }

        // === ОТПРАВКА В GOOGLE FORMS ===
        function submitToGoogleForms() {
            const googleForm = document.getElementById('google-form');
            googleForm.innerHTML = '';
        
            // Анкетные данные (текст)
            for (const [key, value] of Object.entries(state.answers.demographic)) {
                if (Array.isArray(value)) {
                    value.forEach(val => addHiddenField(googleForm, fieldIds[key], val));
                } else if (value) {
                    addHiddenField(googleForm, fieldIds[key], value);
                }
            }
            
            // Тестовые данные (числа)
            state.answers.hardiness.forEach((value, index) => {
                if (value !== null) addHiddenField(googleForm, fieldIds[`h${index+1}`], value);
            });
            state.answers.perma.forEach((value, index) => {
                if (value !== null) addHiddenField(googleForm, fieldIds[`p${index+1}`], value);
            });
            state.answers.gse.forEach((value, index) => {
                if (value !== null) addHiddenField(googleForm, fieldIds[`g${index+1}`], value);
            });
            state.answers.emin.forEach((value, index) => {
                if (value !== null) addHiddenField(googleForm, fieldIds[`e${index+1}`], value);
            });
            
            // === РАСЧЕТ И ОТПРАВКА РЕЗУЛЬТАТОВ ТЕСТОВ ===
            const hardiness = calculateHardinessResults();
            const perma = calculatePermaResults();
            const gse = calculateGSEresult();
            const emin = calculateEminResults();
            
            // Жизнестойкость
    if (hardiness && fieldIds.hardiness_total) {
        addHiddenField(googleForm, fieldIds.hardiness_total, hardiness.total);
        addHiddenField(googleForm, fieldIds.hardiness_engagement, hardiness.engagement);
        addHiddenField(googleForm, fieldIds.hardiness_control, hardiness.control);
        addHiddenField(googleForm, fieldIds.hardiness_risk, hardiness.risk);
    }
    
    // PERMA
    if (perma && fieldIds.perma_total) {
        addHiddenField(googleForm, fieldIds.perma_total, perma.total);
        addHiddenField(googleForm, fieldIds.perma_positive, perma.positive);
        addHiddenField(googleForm, fieldIds.perma_engagement, perma.engagement);
        addHiddenField(googleForm, fieldIds.perma_relationships, perma.relationships);
        addHiddenField(googleForm, fieldIds.perma_meaning, perma.meaning);
        addHiddenField(googleForm, fieldIds.perma_accomplishment, perma.accomplishment);
        addHiddenField(googleForm, fieldIds.perma_happiness, perma.happiness);
        addHiddenField(googleForm, fieldIds.perma_negative, perma.negative);
        addHiddenField(googleForm, fieldIds.perma_health, perma.health);
        addHiddenField(googleForm, fieldIds.perma_loneliness, perma.loneliness);
    }
    
    // GSE
    if (gse && fieldIds.gse_total) {
        addHiddenField(googleForm, fieldIds.gse_total, gse.sum);
        addHiddenField(googleForm, fieldIds.gse_result, gse.fullText);
    }
    
    // ЭМИН
    if (emin && fieldIds.emin_MP) {
        addHiddenField(googleForm, fieldIds.emin_MP, emin.MP);
        addHiddenField(googleForm, fieldIds.emin_MU, emin.MU);
        addHiddenField(googleForm, fieldIds.emin_VP, emin.VP);
        addHiddenField(googleForm, fieldIds.emin_VU, emin.VU);
        addHiddenField(googleForm, fieldIds.emin_VE, emin.VE);
        addHiddenField(googleForm, fieldIds.emin_MEI, emin.MEI);
        addHiddenField(googleForm, fieldIds.emin_VEI, emin.VEI);
        addHiddenField(googleForm, fieldIds.emin_PE, emin.PE);
        addHiddenField(googleForm, fieldIds.emin_UE, emin.UE);
        addHiddenField(googleForm, fieldIds.emin_OEI, emin.OEI);
        }
            
            // Для отладки (показывает результаты в консоли)
            console.log('=== РЕЗУЛЬТАТЫ ===');
            console.log('Жизнестойкость:', hardiness);
            console.log('PERMA:', perma);
            console.log('GSE:', gse);
            console.log('ЭМИН:', emin);
            
            googleForm.submit();
    }

        function addHiddenField(form, name, value) {
            if (!name || name.includes('123456789')) {
                console.warn('Пропущено поле:', name, 'значение:', value);
                return;
            }
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = name;
            input.value = value?.toString();
            form.appendChild(input);
        }

        // === ФУНКЦИИ РАСЧЕТА РЕЗУЛЬТАТОВ ===
        
       // 1. ЖИЗНЕСТОЙКОСТЬ (по вашим формулам)
function calculateHardinessResults() {
    const answers = state.answers.hardiness;
    
    // Вовлеченность: прямые 4,12,22,23,24,29,41; обратные 2,3,10,11,14,28,32,37,38,40,42
    const engagementDirect = [3,11,21,22,23,28,40]; // индексы с 0
    const engagementReverse = [1,2,9,10,13,27,31,36,37,39,41];
    
    let engagement = 0;
    engagementDirect.forEach(idx => {
        if (answers[idx] !== null) engagement += answers[idx];
    });
    engagementReverse.forEach(idx => {
        if (answers[idx] !== null) engagement += (3 - answers[idx]); // обратное кодирование
    });
    
    // Контроль: прямые 9,15,17,21,25,44; обратные 1,5,6,8,16,20,27,31,35,39,43
    const controlDirect = [8,14,16,20,24,43];
    const controlReverse = [0,4,5,7,15,19,26,30,34,38,42];
    
    let control = 0;
    controlDirect.forEach(idx => {
        if (answers[idx] !== null) control += answers[idx];
    });
    controlReverse.forEach(idx => {
        if (answers[idx] !== null) control += (3 - answers[idx]);
    });
    
    // Принятие риска: прямые 34,45; обратные 7,13,18,19,26,30,33,36
    const riskDirect = [33,44];
    const riskReverse = [6,12,17,18,25,29,32,35];
    
    let risk = 0;
    riskDirect.forEach(idx => {
        if (answers[idx] !== null) risk += answers[idx];
    });
    riskReverse.forEach(idx => {
        if (answers[idx] !== null) risk += (3 - answers[idx]);
    });
    
    const total = engagement + control + risk;
    
    return {
        total: total,
        engagement: engagement,
        control: control,
        risk: risk,
        fullText: `Жизнестойкость: ${total} (Вовл:${engagement}, Контр:${control}, Риск:${risk})`
    };
}

// 2. PERMA (по вашим формулам)
function calculatePermaResults() {
    const answers = state.answers.perma;
    
    // Позитивные эмоции: вопросы 3,13,22
    const positiveItems = [2,12,21];
    let positive = 0;
    positiveItems.forEach(idx => {
        if (answers[idx] !== null) positive += answers[idx];
    });
    positive = (positive / positiveItems.length).toFixed(2);
    
    // Вовлеченность: 2,10,17
    const engagementItems = [1,9,16];
    let engagement = 0;
    engagementItems.forEach(idx => {
        if (answers[idx] !== null) engagement += answers[idx];
    });
    engagement = (engagement / engagementItems.length).toFixed(2);
    
    // Взаимоотношения: 8,19,21
    const relationshipsItems = [7,18,20];
    let relationships = 0;
    relationshipsItems.forEach(idx => {
        if (answers[idx] !== null) relationships += answers[idx];
    });
    relationships = (relationships / relationshipsItems.length).toFixed(2);
    
    // Смысл: 7,9,20
    const meaningItems = [6,8,19];
    let meaning = 0;
    meaningItems.forEach(idx => {
        if (answers[idx] !== null) meaning += answers[idx];
    });
    meaning = (meaning / meaningItems.length).toFixed(2);
    
    // Достижения: 1,5,15
    const accomplishmentItems = [0,4,14];
    let accomplishment = 0;
    accomplishmentItems.forEach(idx => {
        if (answers[idx] !== null) accomplishment += answers[idx];
    });
    accomplishment = (accomplishment / accomplishmentItems.length).toFixed(2);
    
    // Счастье: 23
    const happiness = answers[22] !== null ? answers[22].toFixed(2) : null;
    
    // Негативные эмоции: 4,14,16
    const negativeItems = [3,13,15];
    let negative = 0;
    negativeItems.forEach(idx => {
        if (answers[idx] !== null) negative += answers[idx];
    });
    negative = (negative / negativeItems.length).toFixed(2);
    
    // Здоровье: 6,12,18
    const healthItems = [5,11,17];
    let health = 0;
    healthItems.forEach(idx => {
        if (answers[idx] !== null) health += answers[idx];
    });
    health = (health / healthItems.length).toFixed(2);
    
    // Одиночество: 11
    const loneliness = answers[10] !== null ? answers[10].toFixed(2) : null;
    
    // Общий PERMA
    const permaItems = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22];
    let permaTotal = 0;
    let permaCount = 0;
    permaItems.forEach(idx => {
        if (answers[idx] !== null) {
            permaTotal += answers[idx];
            permaCount++;
        }
    });
    permaTotal = (permaTotal / permaCount).toFixed(2);
    
    return {
        total: permaTotal,
        positive: positive,
        engagement: engagement,
        relationships: relationships,
        meaning: meaning,
        accomplishment: accomplishment,
        happiness: happiness,
        negative: negative,
        health: health,
        loneliness: loneliness,
        fullText: `PERMA: ${permaTotal} (Поз:${positive}, Вовл:${engagement}, Отн:${relationships})`
    };
}

// 3. GSE (уже правильная)
function calculateGSEresult() {
    const answers = state.answers.gse;
    let sum = 0;
    let unanswered = 0;
    
    answers.forEach(answer => {
        if (answer !== null) {
            sum += answer;
        } else {
            unanswered++;
        }
    });
    
    if (unanswered > 0) return null;
    
    let level = '';
    if (sum >= 31) {
        level = 'Высокий уровень (31–40 баллов)';
    } else if (sum >= 21) {
        level = 'Средний уровень (21–30 баллов)';
    } else {
        level = 'Низкий уровень (10–20 баллов)';
    }
    
    return {
        sum: sum,
        level: level,
        fullText: `${sum} баллов - ${level}`
    };
}

// 4. ЭМИН (по вашим формулам)
function calculateEminResults() {
    const answers = state.answers.emin;
    
    // МП: + вопросы 1,3,11,13,20,27,29,32,34; - вопросы 38,42,46
    const MP_plus = [0,2,10,12,19,26,28,31,33];
    const MP_minus = [37,41,45];
    
    let MP = 0;
    MP_plus.forEach(idx => {
        if (answers[idx] !== null) MP += answers[idx];
    });
    MP_minus.forEach(idx => {
        if (answers[idx] !== null) MP += (5 - answers[idx]); // обратное кодирование
    });
    
    // МУ: + 9,15,17,24,36; - 2,5,30,40,44
    const MU_plus = [8,14,16,23,35];
    const MU_minus = [1,4,29,39,43];
    
    let MU = 0;
    MU_plus.forEach(idx => {
        if (answers[idx] !== null) MU += answers[idx];
    });
    MU_minus.forEach(idx => {
        if (answers[idx] !== null) MU += (5 - answers[idx]);
    });
    
    // ВП: + 7,14,26; - 8,18,22,31,35,41,45
    const VP_plus = [6,13,25];
    const VP_minus = [7,17,21,30,34,40,44];
    
    let VP = 0;
    VP_plus.forEach(idx => {
        if (answers[idx] !== null) VP += answers[idx];
    });
    VP_minus.forEach(idx => {
        if (answers[idx] !== null) VP += (5 - answers[idx]);
    });
    
    // ВУ: + 4,25,28,37; - 12,33,43
    const VU_plus = [3,24,27,36];
    const VU_minus = [11,32,42];
    
    let VU = 0;
    VU_plus.forEach(idx => {
        if (answers[idx] !== null) VU += answers[idx];
    });
    VU_minus.forEach(idx => {
        if (answers[idx] !== null) VU += (5 - answers[idx]);
    });
    
    // ВЭ: + 19,21,23; - 6,10,16,39
    const VE_plus = [18,20,22];
    const VE_minus = [5,9,15,38];
    
    let VE = 0;
    VE_plus.forEach(idx => {
        if (answers[idx] !== null) VE += answers[idx];
    });
    VE_minus.forEach(idx => {
        if (answers[idx] !== null) VE += (5 - answers[idx]);
    });
    
    // Расчет производных шкал
    const MEI = MP + MU;      // МЭИ = МП + МУ
    const VEI = VP + VU + VE; // ВЭИ = ВП + ВУ + ВЭ
    const PE = MP + VP;       // ПЭ = МП + ВП
    const UE = MU + VU + VE;  // УЭ = МУ + ВУ + ВЭ
    const OEI = MEI + VEI;    // ОЭИ = МЭИ + ВЭИ
    
    return {
        MP: MP, MU: MU, VP: VP, VU: VU, VE: VE,
        MEI: MEI, VEI: VEI, PE: PE, UE: UE, OEI: OEI,
        fullText: `ЭМИН: МП:${MP}, МУ:${MU}, ВП:${VP}, ВУ:${VU}, ВЭ:${VE}`
    };
}

        // === НАВИГАЦИЯ ===
        function showPage(pageNumber) {
            for (let i = 1; i <= 7; i++) {
                document.getElementById(`page-${i}`).classList.add('hidden');
            }
            document.getElementById(`page-${pageNumber}`).classList.remove('hidden');
            state.currentPage = pageNumber;
            updateProgressIndicator(pageNumber);
            window.scrollTo(0, 0);
        }

        function updateProgressIndicator(currentPage) {
            const indicator = document.getElementById('progress-indicator');
            if (currentPage === 1) {
                indicator.classList.add('hidden');
            } else {
                indicator.classList.remove('hidden');
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.classList.remove('active');
                    if (parseInt(step.dataset.step) < currentPage) {
                        step.classList.add('active');
                    }
                });
            }
        }

        // === ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ===
       function toggleInput() {
    const countryInput = document.getElementById('country-input');
    const otherCountryRadio = document.querySelector('input[name="country"][value="Другая страна"]');
    
    if (otherCountryRadio && otherCountryRadio.checked) {
        countryInput.style.display = 'block';
    } else {
        countryInput.style.display = 'none';
        document.getElementById('country-other-text').value = '';
    }
};

        // Показ/скрытие вопросов про формат коучинга
        function toggleCoachingFormat() {
            const coachingFormatQuestion = document.getElementById('coaching-format-question');
            const noCoachingRadio = document.getElementById('no-coaching');
            
            if (noCoachingRadio.checked) {
                coachingFormatQuestion.style.display = 'none';
                // Очищаем выбранные чекбоксы
                document.querySelectorAll('input[name="coaching_format"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.option')?.classList.remove('selected');
                });
                document.getElementById('coaching-other-input').style.display = 'none';
                document.getElementById('coaching-other-input').value = '';
            } else {
                coachingFormatQuestion.style.display = 'block';
            }
        }

        // Показ/скрытие поля "Другое" для формата коучинга
        function toggleCoachingOther() {
            const coachingOtherCheckbox = document.getElementById('coaching-other-checkbox');
            const coachingOtherContainer = document.getElementById('coaching-other-input');
            
            if (coachingOtherCheckbox && coachingOtherContainer) {
            if (coachingOtherCheckbox.checked) {
                coachingOtherContainer.style.display = 'block';
            } else {
                coachingOtherContainer.style.display = 'none';
                document.getElementById('coaching-other-text').value = '';
            }
        }
    }
    </script>
</body>
</html>


